<!DOCTYPE html>
<meta charset="utf-8">
<title>Path Transitions</title>
<style>



.x.axis line {
  shape-rendering: auto;
}

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 2.5px;
}
.svg1{
	margin-top:100px;
}

</style>
<script src="http://d3js.org/d3.v3.js"></script>
<script language="JavaScript" type="text/javascript" src="jquery-1.8.3.js.js"></script>

<script>
var delta=[];
var i=0;
	var data1=[];
var ydomain;
function tick(path, line, data, x) {

  // push a new data point onto the back
	  data.push(respon());
  // redraw the line, and then slide it to the left
  path
      .attr("d", line)
      .attr("transform", null)
      .transition()
      .duration(0)
      .ease("linear")
      .attr("transform", "translate(" + x(-1) + ")")
      .each("end", function() { tick(path, line, data, x); });

  // pop the old data point off the front
  data.shift();

}
var data=[];

d3.csv("ecgtrial.csv", function(error, data1) {
  data1.forEach(function(d) {
    d.das = +d.das;
   var pq = +d.close;
	d.close=pq*100;
	delta.push(d);
  });
  data=delta.slice(0,720);
   ydomain=d3.extent(data1, function(d) { return d.close; });
  chart([0,n-1], "cardinal",tick);
 
});

var n = 720;
  //  random = d3.random.normal(0, .2);
function chart(domain, interpolation, tick) {
// var data = d3.range(n).map(random);

  var margin = {top: 6, right: 0, bottom: 6, left: 40},
      width = 900 - margin.right,
      height = 500;

  var x = d3.scale.linear()
      .domain(domain)
      .range([0, width]);

  var y = d3.scale.linear()
      .domain(ydomain)
      .range([height,0]);

  var line = d3.svg.line()
      .interpolate(interpolation)
      .x(function(d, i) {
		   return x(i); 
			})
      .y(function(d, i) { 
	  		return y(d.close); 
	  });

  var svg = d3.select("body").append("p").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .style("margin-left", -margin.left + "px")
	  .attr("class","svg1")
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


  svg.append("g")
      .attr("class", "y axis")
      .call(y)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em");

  var path = svg.append("g")
      .attr("clip-path", "url(#clip)")
    .append("path")
      .data([data])
      .attr("class", "line")
      .attr("d", line);

  tick(path, line, data, x);

}
var index=5;
function respon(){
det=new Object();
det.close=0;
det.das=0;
$.ajax({
        type:'GET',
        url:"http://localhost:8080/servlets/testing?time="+index,
		data:"time",
        success:function(feed) {
			index=index+1;
			var temp=eval('(' + feed + ')');
			det.das=+temp.tim;
			var x=+temp.val;
			det.close=x*100;
            console.log(temp.time+" " + temp.value);
        },
    });
	return det;
}
</script>

</body>
</html>